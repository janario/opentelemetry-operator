apiVersion: opentelemetry.io/v1alpha1
kind: OpenTelemetryCollector
metadata:
  name: ha
spec:
  mode: ($mode)
  replicas: 2
  #image: <repo>:healthcheckv2
#  lifecycle:
#    preStop:
#      exec:
#        command:
#          - sleep
#          - '1'
  config: |
    extensions:
      #health_check:
      #  endpoint: ${POD_IP}:13133
      healthcheckv2:
        use_v2: true
        component_health:
          include_permanent_errors: false
          include_recoverable_errors: true
          recovery_duration: 5m
        http:
          endpoint: "${POD_IP}:13133"
          status:
            enabled: true
            path: "/health/status"
          config:
            enabled: true
            path: "/health/config"
        grpc:
          endpoint: "${POD_IP}:13132"
          transport: "tcp"
    receivers:
      otlp:
        protocols:
          grpc:
          http:
    processors:

    exporters:
      debug:

    service:
      extensions:
        #- health_check
        - healthcheckv2
      pipelines:
        traces:
          receivers: [otlp]
          processors: []
          exporters: [debug]